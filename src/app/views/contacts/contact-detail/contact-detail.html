<main *ngIf="contact$ | async as contact">
  <app-page-title 
    [title]="contact.firstName + ' ' + contact.lastName" 
    [subtitle]="'CONTACTS.CONTACT_DETAILS' | translate" />

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Information -->
    <div class="lg:col-span-2">
      <div class="space-y-6">
      <!-- Contact Info -->
      <div class="card">
        <div class="card-header">
          <div class="flex items-center gap-4">
            <div class="w-16 h-16 rounded-full bg-primary/10 flex items-center justify-center">
              <span class="text-xl font-semibold text-primary">{{ getInitials(contact) }}</span>
            </div>
            <div class="flex-1">
              <h6 class="card-title">{{ contact.firstName }} {{ contact.lastName }}</h6>
              <p class="text-default-600">{{ contact.email }}</p>
              <div class="flex items-center gap-2 mt-2">
                <span class="py-0.5 px-2.5 inline-flex items-center gap-x-1 text-xs font-medium rounded" 
                      [class]="getStatusClass(contact.status)">
                  <div class="size-3"><ng-icon [name]="getStatusIcon(contact.status)"></ng-icon></div>
                  {{ contact.status | titlecase }}
                </span>
                <span class="py-0.5 px-2.5 inline-flex items-center text-xs font-medium rounded bg-default-100 text-default-600">
                  {{ contact.subscriptionStatus | titlecase }}
                </span>
              </div>
            </div>
          </div>
          
          <div class="flex items-center gap-3">
            <a [routerLink]="['/contacts']" class="btn btn-sm bg-default-100 text-default-600">
              <div class="size-4 me-1"><ng-icon name="lucideArrowLeft"></ng-icon></div>
              {{ 'COMMON.BACK' | translate }}
            </a>
            <a [routerLink]="['/contacts/edit', contact.id]" class="btn btn-sm bg-primary text-white">
              <div class="size-4 me-1"><ng-icon name="lucideFilePen"></ng-icon></div>
              {{ 'COMMON.EDIT' | translate }}
            </a>
            <button (click)="deleteContact(contact)" class="btn btn-sm bg-danger text-white">
              <div class="size-4 me-1"><ng-icon name="lucideTrash2"></ng-icon></div>
              {{ 'COMMON.DELETE' | translate }}
            </button>
          </div>
        </div>
        
        <div class="card-body">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <h6 class="font-medium text-default-700 mb-3">{{ 'CONTACTS.CONTACT_INFO' | translate }}</h6>
              <div class="space-y-3">
                <div *ngIf="contact.phone">
                  <label class="text-sm text-default-600">{{ 'CONTACTS.PHONE' | translate }}</label>
                  <div class="flex items-center gap-2">
                    <div class="size-4 text-default-400"><ng-icon name="lucidePhone"></ng-icon></div>
                    <span class="text-sm">{{ contact.phone }}</span>
                  </div>
                </div>
                
                <div *ngIf="contact.organization">
                  <label class="text-sm text-default-600">{{ 'CONTACTS.ORGANIZATION' | translate }}</label>
                  <div class="flex items-center gap-2">
                    <div class="size-4 text-default-400"><ng-icon name="lucideBuilding"></ng-icon></div>
                    <span class="text-sm">{{ contact.organization }}</span>
                  </div>
                </div>

                <div *ngIf="contact.engagementScore">
                  <label class="text-sm text-default-600">{{ 'CONTACTS.ENGAGEMENT_SCORE' | translate }}</label>
                  <div class="flex items-center gap-2">
                    <div class="size-4 text-default-400"><ng-icon name="lucideActivity"></ng-icon></div>
                    <span class="text-sm">{{ contact.engagementScore }}/100</span>
                    <div class="w-20 h-2 bg-default-200 rounded-full ml-2">
                      <div class="h-full bg-primary rounded-full transition-all" 
                           [style.width]="contact.engagementScore + '%'"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div>
              <h6 class="font-medium text-default-700 mb-3">{{ 'CONTACTS.ACTIVITY_TIMELINE' | translate }}</h6>
              <div class="space-y-3">
                <div>
                  <label class="text-sm text-default-600">{{ 'CONTACTS.CREATED' | translate }}</label>
                  <div class="flex items-center gap-2">
                    <div class="size-4 text-default-400"><ng-icon name="lucideCalendar"></ng-icon></div>
                    <span class="text-sm">{{ contact.createdAt | date:'MMM d, y, h:mm a' }}</span>
                  </div>
                </div>

                <div>
                  <label class="text-sm text-default-600">{{ 'CONTACTS.LAST_UPDATED' | translate }}</label>
                  <div class="flex items-center gap-2">
                    <div class="size-4 text-default-400"><ng-icon name="lucideClock"></ng-icon></div>
                    <span class="text-sm">{{ contact.updatedAt | date:'MMM d, y, h:mm a' }}</span>
                  </div>
                </div>

                <div *ngIf="contact.lastActivity">
                  <label class="text-sm text-default-600">{{ 'CONTACTS.LAST_ACTIVITY' | translate }}</label>
                  <div class="flex items-center gap-2">
                    <div class="size-4 text-default-400"><ng-icon name="lucideActivity"></ng-icon></div>
                    <span class="text-sm">{{ contact.lastActivity | date:'MMM d, y, h:mm a' }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Location -->
      <div *ngIf="contact.location" class="card">
        <div class="card-header">
          <h6 class="card-title">{{ 'CONTACTS.LOCATION_INFO' | translate }}</h6>
        </div>
        <div class="card-body">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div *ngIf="contact.location.country">
              <label class="text-sm text-default-600">{{ 'CONTACTS.COUNTRY' | translate }}</label>
              <div class="flex items-center gap-2">
                <div class="size-4 text-default-400"><ng-icon name="lucideMapPin"></ng-icon></div>
                <span class="text-sm font-medium">{{ contact.location.country }}</span>
              </div>
            </div>

            <div *ngIf="contact.location.state">
              <label class="text-sm text-default-600">{{ 'CONTACTS.STATE' | translate }}</label>
              <span class="text-sm font-medium">{{ contact.location.state }}</span>
            </div>

            <div *ngIf="contact.location.city">
              <label class="text-sm text-default-600">{{ 'CONTACTS.CITY' | translate }}</label>
              <span class="text-sm font-medium">{{ contact.location.city }}</span>
            </div>

            <div *ngIf="contact.location.zipCode">
              <label class="text-sm text-default-600">{{ 'CONTACTS.ZIP_CODE' | translate }}</label>
              <span class="text-sm font-medium">{{ contact.location.zipCode }}</span>
            </div>

            <div *ngIf="contact.location.timezone">
              <label class="text-sm text-default-600">{{ 'CONTACTS.TIMEZONE' | translate }}</label>
              <div class="flex items-center gap-2">
                <div class="size-4 text-default-400"><ng-icon name="lucideClock"></ng-icon></div>
                <span class="text-sm font-medium">{{ contact.location.timezone }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Custom Fields -->
      <div *ngIf="contact.customFields && contact.customFields.length > 0" class="card">
        <div class="card-header">
          <h6 class="card-title">{{ 'CONTACTS.CUSTOM_FIELDS' | translate }}</h6>
        </div>
        <div class="card-body">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div *ngFor="let field of contact.customFields" class="p-3 border border-default-200 rounded-lg">
              <label class="text-sm text-default-600">{{ field.name }}</label>
              <div class="font-medium text-sm">{{ field.value }}</div>
              <span class="text-xs text-default-500 capitalize">{{ field.type }}</span>
            </div>
          </div>
        </div>
      </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="lg:col-span-1">
      <div class="space-y-6">
      <!-- Lists -->
      <div class="card">
        <div class="card-header">
          <h6 class="card-title">{{ 'CONTACTS.CONTACT_LISTS' | translate }}</h6>
          <span class="text-xs text-default-500">{{ contact.lists.length }} {{ 'CONTACTS.LISTS_LOWERCASE' | translate }}</span>
        </div>
        <div class="card-body">
          <div *ngIf="contact.lists.length > 0" class="space-y-3">
            <div *ngFor="let listId of contact.lists" 
                 class="flex items-center justify-between p-3 bg-default-50 rounded-lg border border-default-200">
              <div>
                <div class="font-medium text-sm">{{ getListName((lists$ | async) || [], listId) }}</div>
                <div class="text-xs text-default-600">{{ 'CONTACTS.SUB_STATUS.SUBSCRIBED' | translate }}</div>
              </div>
              <button (click)="removeFromList(contact, listId)" 
                      class="btn size-7.5 bg-danger/10 text-danger hover:bg-danger hover:text-white" 
                      title="Remove from list">
                <div class="size-4"><ng-icon name="lucideX"></ng-icon></div>
              </button>
            </div>
          </div>
          
          <div *ngIf="contact.lists.length === 0" class="text-center text-default-500 py-8">
            <div class="size-8 mx-auto mb-2 text-default-300">
              <ng-icon name="lucideList"></ng-icon>
            </div>
            <p class="text-sm">{{ 'CONTACTS.NOT_SUBSCRIBED' | translate }}</p>
          </div>
        </div>
      </div>

      <!-- Tags -->
      <div class="card">
        <div class="card-header">
          <h6 class="card-title">{{ 'CONTACTS.TAGS' | translate }}</h6>
          <span class="text-xs text-default-500">{{ contact.tags.length }} {{ 'CONTACTS.TAGS_LOWERCASE' | translate }}</span>
        </div>
        <div class="card-body">
          <div *ngIf="contact.tags.length > 0" class="flex flex-wrap gap-2">
            <div *ngFor="let tag of contact.tags" 
                 class="py-0.5 px-2.5 inline-flex items-center gap-x-1 text-xs font-medium rounded bg-secondary/10 text-secondary">
              {{ tag }}
              <button (click)="removeTag(contact, tag)" 
                      class="text-current hover:text-danger ml-1" 
                      title="Remove tag">
                <div class="size-3"><ng-icon name="lucideX"></ng-icon></div>
              </button>
            </div>
          </div>
          
          <div *ngIf="contact.tags.length === 0" class="text-center text-default-500 py-8">
            <div class="size-8 mx-auto mb-2 text-default-300">
              <ng-icon name="lucideTag"></ng-icon>
            </div>
            <p class="text-sm">{{ 'CONTACTS.NO_TAGS' | translate }}</p>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="card">
        <div class="card-header">
          <h6 class="card-title">{{ 'CONTACTS.QUICK_ACTIONS' | translate }}</h6>
        </div>
        <div class="card-body space-y-3">
          <button class="btn bg-primary text-white w-full">
            <div class="size-4 me-1"><ng-icon name="lucideMail"></ng-icon></div>
            {{ 'CONTACTS.SEND_EMAIL' | translate }}
          </button>

          <button class="btn bg-default-100 text-default-600 w-full">
            <div class="size-4 me-1"><ng-icon name="lucideTag"></ng-icon></div>
            {{ 'CONTACTS.ADD_TAG' | translate }}
          </button>

          <button class="btn bg-default-100 text-default-600 w-full">
            <div class="size-4 me-1"><ng-icon name="lucideList"></ng-icon></div>
            {{ 'CONTACTS.ADD_TO_LIST' | translate }}
          </button>

          <button class="btn bg-transparent border border-dashed border-primary text-primary hover:bg-primary/10 w-full">
            <div class="size-4 me-1"><ng-icon name="lucideDownload"></ng-icon></div>
            {{ 'CONTACTS.EXPORT_CONTACT' | translate }}
          </button>
        </div>
      </div>
      </div>
    </div>
  </div>
</main>

<!-- Loading State -->
<div *ngIf="!(contact$ | async)" class="flex items-center justify-center py-12">
  <div class="text-center">
    <div class="size-12 mx-auto mb-4 text-primary animate-spin">
      <ng-icon name="lucideLoader"></ng-icon>
    </div>
    <p class="text-default-600">{{ 'CONTACTS.LOADING_DETAILS' | translate }}</p>
  </div>
</div>